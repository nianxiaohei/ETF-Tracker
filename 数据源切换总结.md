# ETF跟踪系统数据源切换总结

## 变更说明

已将数据从**雪球网**更改为**东方财富网**，原因：
- 雪球网启用了WAF防护，需要配置Cookie才能访问
- 东方财富网API无需Cookie，开箱即用
- 东方财富数据更全面，支持更多ETF

## 技术变更

### 新增文件
- `src/crawler_eastmoney.py` - 东方财富爬虫类

### 修改文件
1. **main.py**
   - 导入：`from src.crawler_eastmoney import EastMoneyCrawler`
   - 使用：`crawler = EastMoneyCrawler()`
   - 移除：雪球Cookie检查逻辑

2. **setup_and_run.py**
   - 测试脚本改为：`src/crawler_eastmoney.py`
   - 说明文档更新为：东方财富数据源（无需Cookie）

3. **quick_setup.py**
   - 测试脚本改为：`src/crawler_eastmoney.py`

### 数据源对比

| 特性 | 雪球网 | 东方财富网 |
|------|--------|----------|
| 认证 | 需要Cookie | 无需认证 |
| 价格格式 | JSON | JSON |
| 价格字段 | `current` | `f43` (除以1000) |
| 市场代码 | `SZ/SH`前缀 | `secid` (0=深圳, 1=上海) |
| 可靠性 | 需要维护Cookie | 稳定 |

## API接口

东方财富实时行情API：
```
https://push2.eastmoney.com/api/qt/stock/get?secid=0.159915&fields=f43,f57,f58,...
```

参数：
- `secid`: 市场代码.ETF代码 (0=深圳, 1=上海)
- `fields`: 返回字段列表

关键字段：
- `f43`: 当前价格 (需要÷1000)
- `f57`: ETF代码
- `f58`: ETF名称
- `f170`: 涨跌幅 (需要÷100)

## 使用说明

### 运行程序
```bash
cd ~/Desktop/ETF_trace
source venv/bin/activate
python main.py
```

### 测试爬虫
```bash
# 测试东方财富爬虫
python -m src.crawler_eastmoney

# 或
source venv/bin/activate
python -m src.crawler_eastmoney
```

## 优势

1. **无需维护Cookie** - 东方财富网不限制API访问
2. **更快速启动** - 节省配置Cookie的步骤
3. **更好的兼容性** - 支持所有ETF代码格式
4. **准确的价格数据** - 与交易软件价格一致

## 界面优化

### 欢迎横幅
- 简化启动欢迎信息
- 移除"支持16只ETF同时监控"字样

### 添加ETF流程
- 将提示从"请输入雪球个股页链接"改为"请输入ETF链接"
- 确认信息从"雪球链接"改为"ETF链接"
- 提高通用性，不再局限于特定数据源

## 后续改进

- [ ] 可以考虑移除XUEQIU_COOKIE相关文档
- [ ] 更新README中的说明
- [ ] 删除或归档旧的雪球爬虫文件（crawler.py, crawler_api.py）
