# 功能3：更新观察列表 使用指南

## 功能概述

功能3允许用户动态管理ETF观察列表，包括：
- 添加新的ETF到观察列表
- 从观察列表删除ETF
- 添加的ETF会自动出现在功能1和功能2中

## 使用步骤

### 1. 进入功能3

在主菜单中选择 `3`：

```
┌─────────────────────────────────────────────────────────────┐
│  请选择功能：                                               │
│                                                             │
│  [bold cyan]1.[/bold cyan] 更新上次交易价格和数量                            │
│  [bold cyan]2.[/bold cyan] 交易信号                                          │
│  [bold cyan]3.[/bold cyan] 更新观察列表                                      │
│  [bold cyan]0.[/bold cyan] 退出程序                                          │
└─────────────────────────────────────────────────────────────┘
```

### 2. 选择操作类型

进入功能3后，会看到子菜单：

```
┌─────────────────────────────────────────────────────────────┐
│  请选择操作：                                               │
│                                                             │
│  [bold cyan]1.[/bold cyan] 删除列表中的ETF                                  │
│     从观察列表中删除指定的ETF                               │
│                                                             │
│  [bold cyan]2.[/bold cyan] 添加ETF                                          │
│     添加新的ETF到观察列表                                   │
│                                                             │
│  [bold cyan]0.[/bold cyan] 返回上级菜单                                      │
└─────────────────────────────────────────────────────────────┘
```

### 3. 添加ETF（选项2）

选择 `2` 后，按提示输入：

1. **ETF代码**：输入ETF代码（如 `SZ159915`）
2. **ETF名称**：输入ETF名称（如 `创业板ETF易方达`）
3. **雪球链接**：输入雪球个股页链接（直接回车使用默认值）

示例：
```
请输入ETF代码（如：SZ159915）: SZ159915
请输入ETF名称: 创业板ETF易方达
请输入雪球个股页链接（直接回车使用默认值: https://xueqiu.com/S/SZ159915）:
```

确认信息后，ETF将被添加到观察列表。

### 4. 删除ETF（选项1）

选择 `1` 后：

1. 系统会显示当前所有ETF的编号列表
2. 输入要删除的ETF编号
3. 确认删除

示例：
```
编号  ETF代码      ETF名称
─────────────────────────────────
1     SH560050     MSCI中国A50ETF
2     SZ159967     创业板成长ETF
...

请选择要删除的ETF编号（1-16），或按回车取消: 2
```

### 5. 查看效果

添加或删除ETF后：

- **功能1**（更新交易数据）：新添加的ETF会显示在列表中，没有交易数据显示为 `--`
- **功能2**（交易信号）：新添加的ETF会被抓取最新价格，但没有交易数据的列显示为 `--`

## 数据存储

ETF观察列表保存在 `data/etf_list.csv` 文件中，格式如下：

```csv
etf_code,etf_name,url,added_at
SZ159915,创业板ETF易方达,https://xueqiu.com/S/SZ159915,2026-02-02 14:25:23
```

**注意**：首次运行时，程序会自动将默认的16只ETF导入此文件。

## 使用示例

### 场景1：添加新的ETF

1. 主菜单 → 选择 `3`（更新观察列表）
2. 子菜单 → 选择 `2`（添加ETF）
3. 输入ETF信息
4. 主菜单 → 选择 `1`（更新交易数据）
5. 可以看到新添加的ETF，输入其交易价格和数量

### 场景2：删除不需要的ETF

1. 主菜单 → 选择 `3`（更新观察列表）
2. 子菜单 → 选择 `1`（删除ETF）
3. 选择要删除的ETF编号
4. 确认删除
5. 之后功能1和功能2将不再显示该ETF

### 场景3：只观察但不交易

1. 添加ETF到观察列表
2. 不要在功能1中为其设置交易价格和数量
3. 在功能2中可以看到该ETF的最新价格，但交易相关列显示为 `--`

## 注意事项

1. **首次运行**：程序会自动初始化默认的16只ETF
2. **数据独立**：删除ETF不会删除其交易数据，只是不再显示
3. **重复添加**：如果ETF已存在，无法重复添加
4. **交易可选**：新添加的ETF可以不设置交易数据，仅用于观察

## 技术说明

### 修改的文件

1. **src/storage.py**：新增 `ETFListStorage` 类
   - `add_etf()` - 添加ETF
   - `remove_etf()` - 删除ETF
   - `get_all_etfs()` - 获取所有ETF
   - `init_default_etfs()` - 初始化默认ETF

2. **config/app.py**：添加 `etf_list` 文件配置

3. **main.py**：新增功能3及相关函数
   - `update_etf_watchlist()` - 功能3主入口
   - `add_etf_to_watchlist()` - 添加ETF（选项2）
   - `remove_etf_from_watchlist()` - 删除ETF（选项1）
   - 修改 `update_transaction_data()` - 支持动态ETF列表
   - 修改 `analyze_trading_signals()` - 支持显示无交易数据的ETF

### 数据流

```
用户操作 → main.py → etf_list_storage (CSV) → 功能1/功能2读取
```

## 常见问题

**Q: 删除ETF后，之前设置的交易数据会丢失吗？**
A: 不会。交易数据保存在 `user_transactions.csv` 中，删除ETF只影响观察列表，不影响历史数据。

**Q: 可以添加任意ETF吗？**
A: 可以，只要雪球网站有该ETF的数据页面即可。

**Q: 新添加的ETF必须设置交易数据吗？**
A: 不是必须的。可以不设置，仅在功能2中观察价格变化。

**Q: 支持添加多少只ETF？**
A: 没有硬限制，但建议根据实际需要添加，过多会影响抓取速度。
